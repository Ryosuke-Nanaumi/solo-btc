# 💪 FitRanker(競争型ワークアウト記録アプリ)

## 💡 1. プロジェクト概要

FitRanker は、モチベーション維持を目的とした競争（ランキング）機能付きのワークアウト記録アプリケーションです。記録したトレーニング内容に基づき自動で「ポイント」を計算し、ユーザー間でランキングを競い合う仕組みを提供します。

### キーコンセプト

- ポイント制: ワークアウトのレップ数に応じてポイントを獲得。
- 競争と可視化: 参加ユーザー中、自分が何位か（N 人中 M 位）を明確に表示。

## ⚙️ 2. 技術スタックとアーキテクチャ

本プロジェクトは、npm Workspaces を利用したモノレポ構造を採用しています。
| レイヤー |テクノロジー | 役割 |
| ------- | -------- | ---- |
| モノレポ管理 | npm Workspaces | `front/` と `server/`の依存関係・コマンド管理 |
| バックエンド | Node.js / Express | API エンドポイント、ビジネスロジック (ポイント計算) |
| データベース | PostgreSQL / Knex.js | データ永続化、SQL クエリビルド |
| 言語 | TypeScript | 全体での型安全性の確保 |

## 🚀 3. 開発環境のセットアップ

プロジェクトのセットアップは、ルートの package.json に定義されたコマンド (`npm run [command]`) で一元管理します。

### 3-1. 初期セットアップ (初回のみ)

```
# 1. 依存関係のインストール (front/ & server/ を一括で)
npm install

# 2. データベースの作成
PostgreSQL にアプリ用データベースを作成
psql -U postgres
CREATE DATABASE training;
\q

# 3. データベースのセットアップと初期データ投入
# (ロールバック -> マイグレーション -> シード実行を連続で行う)
npm run db:reset --workspace=server
```

### 3-2. 開発サーバーの起動

ターミナルを 2 つ開き、それぞれでフロントエンドとバックエンドを起動します。

| プロジェクト        | コマンド           | URL                        |
| ------------------- | ------------------ | -------------------------- |
| バックエンド (API)  | npm run dev:server | http://localhost:3000 など |
| フロントエンド (UI) | npm run dev:front  | http://localhost:5173 など |

### 3-3. テスト実行

本プロジェクトでは、Vitest を使用してテストを実行します。(現在serverのテストのみ対応)
ルートディレクトリで以下のコマンドを利用できます。

#### 全体テスト(現在はserverのみ)
```
npm test
```

#### バックエンドのテスト
```
# server/ 配下のすべてのテスト（ユニット + 結合テスト）を実行
npm run test:server

# ユニットテストのみ実行（結合(Integration)テストを含まないテスト）
npm run test:server:unit

# 結合テストを実行
npm run test:server:int

```
> [!WARNING]
> 結合テストでは`test`環境が使用されるため、初回のみテスト用データベースの作成とマイグレーションが必要です。結合テストの実行が必要な場合、以下のセットアップ処理を行なってください。
> ```
> # 1. PostgreSQL にテスト用 DB を作成（training_test）
> psql -U postgres
> CREATE DATABASE training_test;
> \q
> 
> # 2. テスト用 DB にマイグレーションを適用
> npm run db:migrate:test --workspace=server
> 
> # 3. 結合テスト実行
> npm run test:server:int
> ```

## 💡 4. 今後の展望
- ログイン機能の追加
  - ユーザーごとにポイントを競い合う機能の実装
- 消費カロリーの自動計算機能を追加